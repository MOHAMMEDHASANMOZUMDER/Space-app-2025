<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Modular recycling system for sustainable Mars exploration." />
  <link rel="stylesheet" href="style2.css" />
  <title>Mars Recycler</title>
</head>
<body>
  <div id="container"></div>

  <header>
    <div class="nav">
      <div class="logo">
        <a href="#project-hero" aria-label="Mars Recycler Home" style="display:flex;align-items:center;gap:.5rem;text-decoration:none;color:inherit;">
          <svg width="32" height="32" viewBox="0 0 64 64" role="img" aria-label="Mars planet logo" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <radialGradient id="marsGrad" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="#f2a57e"/>
                <stop offset="60%" stop-color="#c36a4a"/>
                <stop offset="100%" stop-color="#8b3b2e"/>
              </radialGradient>
            </defs>
            <circle cx="32" cy="32" r="30" fill="url(#marsGrad)"/>
            <path d="M8 28c8-6 20-8 32-4M10 40c10-4 18-2 28 2M22 18c6 2 10 4 18 6" stroke="#7a2f25" stroke-width="3" stroke-linecap="round" opacity=".5" fill="none"/>
            <circle cx="46" cy="18" r="3" fill="#e8cbaa" opacity=".8"/>
          </svg>
          <span>Mars Recycler</span>
        </a>
      </div>
      <nav class="links">
        <a href="#project-hero">Home</a>
        <a href="#Workflow">Workflow</a>
        <a href="#gallery">Models</a>
        <a href="#architecture">Architecture</a>
      </nav>
      <a href=""></a>
    </div>
  </header>

  <!-- HERO -->
  <section id="project-hero" class="content-section">
    <div class="content-inner">
      <div class="text-content">
        <div class="left-hero">
          <div id="mars-canvas" class="mars-canvas" aria-hidden="false"></div>
          <div class="hero-overlay">
            <a class="nasa-badge" href="https://www.spaceappschallenge.org/" target="_blank" rel="noopener" aria-label="NASA Space Apps" style="display:flex;align-items:center;gap:.5rem;text-decoration:none;color:inherit;">
              <img width="48" height="48" src="https://img.icons8.com/color/48/nasa.png" alt="NASA"/>
              <span>NASA Space Apps</span>
            </a>
            <h1 class="title">Mars</h1>
            <h2 class="subtitle" style="color:#9C2E35;">Recycler</h2>
            <p class="description" style="color:#ffffff;">
              Revolutionary modular recycling system for sustainable Mars exploration. Converting space waste into valuable resources through advanced pyrolysis and reformation technology.
            </p>
            <a href="#system" class="cta-danger" role="button" aria-label="Explore System">
              Explore System <span class="arrow" aria-hidden="true">‚Üí</span>
            </a>
          </div>
        </div>
      </div>
      <div class="video-content" aria-label="YouTube video ">
        <iframe width="360" height="200" src="https://www.youtube.com/embed/n2dVFdqMYGA" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
      </div>
    </div>
  </section>

  <section id="Workflow" class="section">
    <div class="wrap">
      <h2 class="title">Workflow</h2>
      <p class="subtitle">Processing flow and energy storage pipeline</p>
      <div class="architecture">
        <div class="flowchart-container" style="background-image: url('textures/Flowchart.png'); height: 500px; background-size: contain; background-repeat: no-repeat; background-position: center;" aria-label="Waste2Watt Flowchart">
        </div>
      </div>
    </div>
  </section>

  <section id="gallery" class="section" style="background:#151515">
    <div class="wrap">
      <h2 class="title" style="color:var(--mars-orange)">Models</h2>
      <p class="subtitle">Caption or details</p>
      <div class="gallery">
        
        <div class="card">
          <div class="card-img">
            <iframe scrolling='no' frameborder='0' allowfullscreen='true' src='https://www.3dcontentcentral.com/external-site-embed.aspx?format=3D&catalogid=171&modelid=3202882&width=250&height=250&edraw=true' name='PreviewFrame3D' id='PreviewFrame3D' style="width:100%; height:250px; border:0;"></iframe>
            <span class="card-tag">3D Model</span>
          </div>
          <div class="card-body">
            <h4>Pyrolysis Reactor</h4>
            <p>Interactive 3D model of the core reactor component. <a href='https://www.3dcontentcentral.com/download-model.aspx?catalogid=171&id=3202882' target="_blank" rel="noopener"></a></p>
            <a href="model.html" class="cta-link" role="button">View</a>
          </div>
        </div>
        <div class="card">
          <div class="card-img">
            <img src="textures/Flowchart.png" alt="System Flowchart" style="width:300px; height:250px; border:0;">
            <span class="card-tag">Diagrams</span>
          </div>
          <div class="card-body">
            <h4>System Flowchart</h4>
            <p>Complete system architecture showing waste processing flow and power generation.</p>
            <a href="textures/Flowchart.png" class="cta-link" role="button">View</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="system" class="section">
    <div class="wrap">
      <h2 class="title">Subsystem Specifications</h2>
      <p class="subtitle">Detailed breakdown of modules and features</p>
      <div class="specs">
        <div class="spec"><h4>Intake & Shredder</h4><p>details</p></div>
        <div class="spec"><h4>Intelligent Sorting</h4><p>details</p></div>
        <div class="spec"><h4>Pyrolysis</h4><p>details</p></div>
        <div class="spec"><h4>Reforming</h4><p>details</p></div>
        <div class="spec"><h4>Cleanup</h4><p>details</p></div>
        <div class="spec"><h4>Condenser</h4><p>details</p></div>
        <div class="spec"><h4>SOFC Power</h4><p>details</p></div>
        <div class="spec"><h4>Power Management</h4><p>details</p></div>
      </div>
    </div>
  </section>

<section id="workflow" class="section">
    <div class="wrap">
        <h2 class="title">‚ôªÔ∏è Workflow</h2>
        <div id="workflow-steps"></div>
    </div>
</section>

<section id="architecture" class="section">
    <div class="wrap">
        <h2 class="title">‚ö° Interactive Waste Mix</h2>
        <p class="subtitle">Adjust sliders to see the normalized preview and calculate the energy output.</p>
        
        <div class="waste-mixer-container">
            <div class="sliders-container">
                <!-- Sliders will be injected here by script -->
            </div>
            <div class="results-container">
                <div class="total-weight-container">
                    <label for="total-weight">Total Waste (kg):</label>
                    <input type="number" id="total-weight" value="100" min="1">
                </div>
                <div id="process-result" class="data-box">
                    <!-- Result will be shown here -->
                </div>
            </div>
        </div>
    </div>
</section>

<section id="waste-types" class="section">
    <div class="wrap">
        <h2 class="title">üóëÔ∏è Waste Types</h2>
        <div id="waste-list"></div>
    </div>
</section>

<section id="mars-data" class="section">
    <div class="wrap">
        <h2 class="title">üåå Mars Data</h2>
        <div id="mars-weather" class="data-box">Loading weather...</div>
        <div id="mars-photos" class="data-box">Loading photos...</div>
    </div>
</section>

  <footer>
    <div class="foot-wrap"></div>
    <div class="copyright">¬© 2025 Mars Recycler Project. All rights reserved.</div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/three@0.152.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.0/examples/js/controls/OrbitControls.js"></script>
  <script src="script.js"></script>

  <script>
    const API_URL = "http://localhost:5000";
    (function () {
      const container = document.getElementById("workflow-steps");
      if (!container) return;
      fetch(`${API_URL}/api/workflow`)
        .then((r) => r.json())
        .then((data) => {
          container.innerHTML = "";
          (data.steps || []).forEach((step) => {
            const div = document.createElement("div");
            div.className = "data-box";
            div.textContent = step;
            container.appendChild(div);
          });
        })
        .catch(() => {
          container.textContent = "Failed to load workflow.";
        });
    })();

    (function () {
      const container = document.getElementById("waste-list");
      if (!container) return;
      fetch(`${API_URL}/api/waste-types`)
        .then((r) => r.json())
        .then((data) => {
          container.innerHTML = "";
          (data || []).forEach((waste) => {
            const div = document.createElement("div");
            div.className = "data-box";
            const eff = waste.efficiency != null ? (waste.efficiency * 100).toFixed(0) + "%" : "N/A";
            const byp = Array.isArray(waste.byproducts) ? waste.byproducts.join(", ") : "N/A";
            div.innerHTML = `<b>${String(waste.type || "").toUpperCase()}</b><br>Efficiency: ${eff}<br>Byproducts: ${byp}`;
            container.appendChild(div);
          });
        })
        .catch(() => {
          container.textContent = "Failed to load waste types.";
        });
    })();
    
    const wasteCategories = [
        { name: 'Organic', value: 10 },
        { name: 'Plastics', value: 35 },
        { name: 'Metals', value: 20 },
        { name: 'Glass', value: 10 },
        { name: 'Textiles', value: 15 },
        { name: 'Electronics', value: 5 },
        { name: 'Other', value: 5 }
    ];

    const slidersContainer = document.querySelector('.sliders-container');
    const resultEl = document.getElementById('process-result');
    const totalWeightInput = document.getElementById('total-weight');
    let sliders = [];

    function renderSliders() {
        slidersContainer.innerHTML = '';
        sliders = [];
        wasteCategories.forEach((cat, index) => {
            const sliderId = `slider-${index}`;
            const percentageId = `percentage-${index}`;
            const sliderHTML = `
                <div class="slider-group">
                    <label for="${sliderId}">${cat.name}</label>
                    <input type="range" id="${sliderId}" class="waste-slider" min="0" max="100" value="${cat.value}" data-index="${index}">
                    <span id="${percentageId}" class="percentage-display">${cat.value}%</span>
                </div>
            `;
            slidersContainer.innerHTML += sliderHTML;
        });

        sliders = Array.from(document.querySelectorAll('.waste-slider'));
        sliders.forEach(slider => {
            slider.addEventListener('input', handleSliderInput);
        });
    }

    function handleSliderInput(event) {
        const changedIndex = parseInt(event.target.dataset.index);
        let changedValue = parseInt(event.target.value);
        
        wasteCategories[changedIndex].value = changedValue;

        const total = wasteCategories.reduce((sum, cat) => sum + cat.value, 0);
        let diff = total - 100;

        if (diff !== 0) {
            let remainingSum = 100 - changedValue;
            let otherSum = total - changedValue;
            
            wasteCategories.forEach((cat, index) => {
                if (index !== changedIndex) {
                    if (otherSum > 0) {
                        cat.value = Math.round((cat.value / otherSum) * remainingSum);
                    } else {
                        cat.value = Math.round(remainingSum / (wasteCategories.length - 1));
                    }
                }
            });
        }
        
        // Final check to ensure sum is 100 due to rounding
        let finalSum = wasteCategories.reduce((sum, cat) => sum + cat.value, 0);
        let sumDiff = 100 - finalSum;
        if (sumDiff !== 0) {
            const nonZero = wasteCategories.find(c => c.value > 0 && c.value + sumDiff > 0);
            if(nonZero) nonZero.value += sumDiff;
            else wasteCategories[0].value += sumDiff;
        }


        updateUI();
        simulateProcess();
    }

    function updateUI() {
        wasteCategories.forEach((cat, index) => {
            sliders[index].value = cat.value;
            document.getElementById(`percentage-${index}`).textContent = `${cat.value}%`;
        });
    }

    function simulateProcess() {
      const totalWeight = parseFloat(totalWeightInput.value);
      if (!isFinite(totalWeight) || totalWeight <= 0) {
        resultEl.textContent = "Enter a valid total weight.";
        return;
      }

      const wasteMix = wasteCategories.reduce((acc, cat) => {
        acc[cat.name.toLowerCase()] = cat.value;
        return acc;
      }, {});

      fetch(`${API_URL}/api/process`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ wasteMix, totalWeight }),
      })
        .then((r) => r.json())
        .then((res) => {
          if (res.error) {
            resultEl.textContent = res.error;
            return;
          }
          const byp = Array.isArray(res.byproducts) ? res.byproducts.join(", ") : "N/A";
          resultEl.innerHTML =
            `<b>Processed ${res.input_weight} kg of waste</b><br>
             Energy Generated: ‚ö° ${res.energy_kwh} kWh<br>
             Byproducts: ${byp}`;
        })
        .catch(() => {
          resultEl.textContent = "Processing failed.";
        });
    }

    totalWeightInput.addEventListener('input', simulateProcess);

    document.addEventListener('DOMContentLoaded', () => {
        renderSliders();
        simulateProcess();
    });

    function simulateProcessOld() {
      const typeEl = document.getElementById("waste-type");
      const weightEl = document.getElementById("waste-weight");
      const resultEl = document.getElementById("process-result");
      if (!typeEl || !weightEl || !resultEl) return;

      const type = typeEl.value;
      const weight = parseFloat(weightEl.value);
      if (!isFinite(weight) || weight <= 0) {
        resultEl.textContent = "Enter a valid weight.";
        return;
      }

      fetch(`${API_URL}/api/process`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ type, weight }),
      })
        .then((r) => r.json())
        .then((res) => {
          if (res.error) {
            resultEl.textContent = res.error;
            return;
          }
          const byp = Array.isArray(res.byproducts) ? res.byproducts.join(", ") : "N/A";
          resultEl.innerHTML =
            `<b>Processed ${res.input_weight} kg of ${res.type} waste</b><br>
             Energy Generated: ‚ö° ${res.energy_kwh} kWh<br>
             Byproducts: ${byp}`;
        })
        .catch(() => {
          resultEl.textContent = "Processing failed.";
        });
    }

    (function () {
      const box = document.getElementById("mars-weather");
      if (!box) return;
      fetch(`${API_URL}/api/mars-weather`)
        .then((r) => r.json())
        .then((res) => {
          if (!res.available) {
            box.innerHTML = `Weather Unavailable<br><small>${res.note || "No data returned."}</small>`;
            return;
          }
          box.innerHTML =
            `<b>Sol ${res.sol ?? "N/A"}</b><br>
             Date: ${res.date ? new Date(res.date).toDateString() : "N/A"}<br>
             Temperature: ${res.temp != null ? res.temp + " ¬∞C" : "N/A"}<br>
             Wind: ${res.wind != null ? res.wind + " m/s" : "N/A"}<br>
             Pressure: ${res.pressure != null ? res.pressure + " Pa" : "N/A"}<br>
             <small>Source: ${res.source || "NASA"}</small>`;
        })
        .catch(() => {
          box.textContent = "Failed to load Mars weather.";
        });
    })();

    (function () {
      const container = document.getElementById("mars-photos");
      if (!container) return;

      container.textContent = "Loading photos...";

      fetch(`${API_URL}/api/mars-photos`)
        .then((r) => r.json())
        .then((res) => {
          const photos = Array.isArray(res.photos) ? res.photos : [];
          container.innerHTML = "";

          if (photos.length === 0) {
            container.innerHTML = `No photos available.<br><small>${res.note || ""}</small>`;
            return;
          }

          const meta = document.createElement("div");
          meta.style.marginBottom = "8px";
          meta.innerHTML = `<small>Rover: ${res.rover || "Curiosity"} ‚Ä¢ Sol: ${res.sol ?? "‚Äî"} ‚Ä¢ Source: ${res.source || "NASA"}</small>`;
          container.appendChild(meta);

          photos.forEach((src) => {
            const img = document.createElement("img");
            img.src = src;
            img.alt = "Mars rover";
            img.style.width = "200px";
            img.style.margin = "5px";
            img.loading = "lazy";
            container.appendChild(img);
          });
        })
        .catch(() => {
          container.textContent = "Failed to load rover photos.";
        });
    })();
  </script>
</body>
</html>
